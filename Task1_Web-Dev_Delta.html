<!DOCTYPE html>
<html>
	<head>
		<title>Note Maker</title>
	   	<style>
			.buttons{
				background:lightblue;
				border-radius: 10px;
				width: 10em;
				height: 3em;
				position: absolute;
				top: 100px;
			}
			body{
				background-color:black;
			}
			#background{
				background-color:#000000;
			}
			#adder  {
				left: 30%;
        		}
        		#deleter  {
				left: 85%;
        		}
        		#editor  {
				left: 60%;
        		}
			select{
				margin-top:30px;
			}
			#text {
				display: block;
				background-color:black;
				width:100%;
				margin-left: auto;
				margin-right: auto;
				color:white;
			}
			ul {
				list-style-type:none;
				height:550px;
				background:#000000;
				margin-top:100px;
				overflow:scroll;
				overflow-x:hidden;
				padding:0;
        		}	
			li{
				float:down;
        			display : block;
				color:white;
				border-style:solid;
				text-align: center;
				padding : 30px;
				text-decoration:none;
			}
			.a{
				background-color:#000000
				}
        		.a1{
				background-color:#ff0000
        		}
			.a2{
				background-color:#af0000
        		}
			.a3{
				background-color:#4f0000
        		}
		</style>
	</head>
	<body>
		<div id="background">
			<textarea id="text" rows=4 columns=400 onclick="disabler()"></textarea>
			<select id="dropper">
				<option value="1">High</option>
				<option value="2">Medium</option>
				<option value="3" selected="selected">Low</option>
			</select>
			<button class="buttons" id="deleter" onclick="remove()">Remove</button>
			<button class="buttons"id="editor" onclick="editor()">Edit</button>
			<button class="buttons"id="adder" onclick="add()">Add</button>
			<button class="buttons" id="sorter" onclick="sorter()">Sort</button>
			<ul id="main list" style="list-style-type:square"></ul>
		</div>
		<script>
			class list_item{
				constructor(text,priority){
				this.text=text;
				this.priority=priority;
				}
			}
			var x=0;
			var del=0;
			var edit=0;
			var updat=0;
	 		var selected=false;
	 		var item=0;
	 		disableAll();
	 		update();
         		//localStorage items of form index hold the text and of the form "p"+index hold the priority
			function update(){
				document.getElementById("main list").innerHTML="";
				x=localStorage.count;
				for(i=1;i<=x;i++){
					var update_item=JSON.parse(localStorage.getItem(i));
					var text=update_item.text;
					document.getElementById("main list").innerHTML+="<li id="+i+" class=a"+update_item.priority+"><a>"+text+"</li>";
				}
				bind();
				if(!localStorage.count||localStorage.count==0)
					document.getElementById("main list").innerHTML="<li>"+"No notes to display"+"</li>";
			}
	 		
			function bind(){
				//Adding event listener by binding it
				//Can't add event listeners directly because id of selected element reqd
				var binder;
				for(i=1;i<=localStorage.count;i++){

					var binderClass = function(element){
						this.iod=i;
						this.onclick1= function(event){
							selector(this.iod);
						};
						element.addEventListener("click",this.onclick1.bind(this),false);
					}
					binder=new binderClass(document.getElementById(""+i));
				}
			}	
			
			function selector(i){
				update();
				var selecti=JSON.parse(localStorage.getItem(i));
				document.getElementById("editor").disabled=false;
				document.getElementById("deleter").disabled=false;
				document.getElementById("adder").disabled=true;
				selected=true;					// Used in edit and delete functions 
				item=i;						// Index of selected item is saved thus					   
				document.getElementById("dropper").value=selecti.priority;
			 	document.getElementById(item).style.background="#1313ef";
				document.getElementById("text").value="";
				document.getElementById("text").value+=selecti.text;
	 		} 	
	 		
			function disabler(){
				if(selected==false)
					document.getElementById("editor").disabled=true;
				document.getElementById("deleter").disabled=true;
				document.getElementById("adder").disabled=false;
	 		}
	 		
			function disableAll(){
				document.getElementById("editor").disabled=true;
				document.getElementById("deleter").disabled=true;
				document.getElementById("adder").disabled=true;
			}
			
			function remove(){
				//Removal by overwriting and reducing total count
				var i=item;								//Item obtained from selector function
				if(selected==true){
					for(x=i;x<localStorage.count;x++){
						localStorage.setItem(x,localStorage.getItem(x+1));
					}	
					localStorage.count= Number(localStorage.count)-1;
					update();
				}
				selected=false;
				disableAll();
	 		}
			
			function editor(){
				//Edit by modifying/resetting item in localStorage and reading from it
				update();
				if(selected){
					var i=item;						// item obtained from selector function
					var drop=document.getElementById("dropper");
					var editeditem = new list_item();
					editeditem.text=document.getElementById("text").value;
					editeditem.priority=parseInt(drop.options[drop.selectedIndex].value)
					localStorage.setItem(i,JSON.stringify(editeditem));
					update();
				}	
				selected=false;
				disableAll();
         		}	
			
	 		function sorter(){
				//Counting Sort the elements based on priority
				var count=Number(localStorage.count);
				var objectarray=[];
				var priority=[];
				var count_priorty=[];
				count_priorty[0]=count_priorty[1]=count_priorty[2]=count_priorty[3]=0;
				for(i=1;i<=count;i++)
					objectarray[i-1]=JSON.parse(localStorage.getItem(i));	
				for(j=1;j<=count;j++)
					priority[j-1]=objectarray[j-1].priority;
				for(i=0;i<=count;i++)
					count_priorty[priority[i]]++;
				count_priorty[2]+=count_priorty[1];
				for(i=0;i<count;i++){
					var indexer=(count_priorty[priority[i]-1]+1);
					localStorage.setItem(indexer,JSON.stringify(objectarray[i]));
					count_priorty[priority[i]-1]++;
				}
				update();
	 		}
	 		
			function add(){
				if(!localStorage.count)
					localStorage.count=1;
				else
					localStorage.count=Number(localStorage.count)+1;
				//Get text from drop_down box
				var text=document.getElementById("text").value;
				var addeditem= new list_item();
				var drop=document.getElementById("dropper");
				addeditem.text=text;
				addeditem.priority=parseInt(drop.options[drop.selectedIndex].value);
				//Get Priority From drop_down box
				document.getElementById("main list").innerHTML+="<li id="+Number(localStorage.count)+"><a>"+text+"</a></li>";
				document.getElementById("text").value="";
				localStorage.setItem(localStorage.count,JSON.stringify(addeditem));
				update();
			}
			
		</script>
	</body>
</html>
